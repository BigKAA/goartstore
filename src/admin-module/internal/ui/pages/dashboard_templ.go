// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.977
package pages

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

import (
	"encoding/json"
	"fmt"
	"strconv"

	"github.com/arturkryukov/artstore/admin-module/internal/ui/components"
	"github.com/arturkryukov/artstore/admin-module/internal/ui/layouts"
)

// DashboardData — данные для страницы Dashboard.
// Содержит агрегированные метрики, собранные из сервисов.
type DashboardData struct {
	Username string // Имя пользователя из сессии
	Role     string // Роль пользователя

	// --- Storage Elements ---
	SETotal       int // Общее количество SE
	SEOnline      int // SE со статусом online
	SEOffline     int // SE со статусом offline
	SEDegraded    int // SE со статусом degraded
	SEMaintenance int // SE со статусом maintenance

	// --- Хранилище ---
	StorageTotalBytes int64 // Суммарная ёмкость всех SE (байт)
	StorageUsedBytes  int64 // Суммарное использование всех SE (байт)

	// --- Файлы ---
	FilesTotal     int // Общее число активных файлов
	FilesPermanent int // Файлы с retention permanent
	FilesTemporary int // Файлы с retention temporary

	// --- Service Accounts ---
	SATotal     int // Общее число SA
	SAActive    int // Active SA
	SASuspended int // Suspended SA

	// --- Зависимости ---
	Dependencies []DependencyStatus // Статусы зависимостей (PG, KC)

	// --- Список SE (для таблицы и графиков) ---
	StorageElements []SEItem
}

// DependencyStatus — статус зависимости.
type DependencyStatus struct {
	Name   string // Имя (PostgreSQL, Keycloak)
	Status string // online, offline, unavailable
}

// SEItem — элемент Storage Element для отображения в таблице и графиках.
type SEItem struct {
	ID            string
	Name          string
	Mode          string // edit, rw, ro, ar
	Status        string // online, offline, degraded, maintenance
	CapacityBytes int64
	UsedBytes     int64
	FileCount     int
}

// seStorageChartData — данные для графика использования хранилища.
type seStorageChartData struct {
	Names []string  `json:"names"`
	Used  []float64 `json:"used"`
	Total []float64 `json:"total"`
}

// seFilesChartData — данные для графика распределения файлов.
type seFilesChartData struct {
	Names  []string `json:"names"`
	Counts []int    `json:"counts"`
}

// storageChartJSON формирует JSON-данные для графика использования хранилища по SE.
func storageChartJSON(items []SEItem) string {
	data := seStorageChartData{
		Names: make([]string, 0, len(items)),
		Used:  make([]float64, 0, len(items)),
		Total: make([]float64, 0, len(items)),
	}

	const GB = 1024 * 1024 * 1024

	for _, se := range items {
		data.Names = append(data.Names, se.Name)
		data.Used = append(data.Used, float64(se.UsedBytes)/float64(GB))
		data.Total = append(data.Total, float64(se.CapacityBytes)/float64(GB))
	}

	b, _ := json.Marshal(data)
	return string(b)
}

// filesChartJSON формирует JSON-данные для графика распределения файлов по SE.
func filesChartJSON(items []SEItem) string {
	data := seFilesChartData{
		Names:  make([]string, 0, len(items)),
		Counts: make([]int, 0, len(items)),
	}

	for _, se := range items {
		if se.FileCount > 0 {
			data.Names = append(data.Names, se.Name)
			data.Counts = append(data.Counts, se.FileCount)
		}
	}

	b, _ := json.Marshal(data)
	return string(b)
}

// seSubValue формирует описание для stat_card SE.
func seSubValue(data DashboardData) string {
	parts := ""
	if data.SEOnline > 0 {
		parts += fmt.Sprintf("%d online", data.SEOnline)
	}
	if data.SEOffline > 0 {
		if parts != "" {
			parts += " / "
		}
		parts += fmt.Sprintf("%d offline", data.SEOffline)
	}
	if data.SEDegraded > 0 {
		if parts != "" {
			parts += " / "
		}
		parts += fmt.Sprintf("%d degraded", data.SEDegraded)
	}
	if data.SEMaintenance > 0 {
		if parts != "" {
			parts += " / "
		}
		parts += fmt.Sprintf("%d maintenance", data.SEMaintenance)
	}
	if parts == "" {
		return "Нет зарегистрированных SE"
	}
	return parts
}

// filesSubValue формирует описание для stat_card файлов.
func filesSubValue(data DashboardData) string {
	if data.FilesTotal == 0 {
		return "Нет файлов в реестре"
	}
	return fmt.Sprintf("%d permanent / %d temporary", data.FilesPermanent, data.FilesTemporary)
}

// saSubValue формирует описание для stat_card SA.
func saSubValue(data DashboardData) string {
	if data.SATotal == 0 {
		return "Нет Service Accounts"
	}
	return fmt.Sprintf("%d active / %d suspended", data.SAActive, data.SASuspended)
}

// storageSubValue формирует описание для stat_card хранилища.
func storageSubValue(data DashboardData) string {
	if data.StorageTotalBytes == 0 {
		return "SE не зарегистрированы"
	}
	return fmt.Sprintf("%s из %s используется", formatBytesLocal(data.StorageUsedBytes), formatBytesLocal(data.StorageTotalBytes))
}

// formatBytesLocal — локальное форматирование байтов (аналог из capacity_bar).
func formatBytesLocal(bytes int64) string {
	if bytes < 0 {
		bytes = 0
	}
	const (
		KB = 1024
		MB = 1024 * KB
		GB = 1024 * MB
		TB = 1024 * GB
	)
	switch {
	case bytes >= TB:
		return fmt.Sprintf("%.1f TB", float64(bytes)/float64(TB))
	case bytes >= GB:
		return fmt.Sprintf("%.1f GB", float64(bytes)/float64(GB))
	case bytes >= MB:
		return fmt.Sprintf("%.1f MB", float64(bytes)/float64(MB))
	case bytes >= KB:
		return fmt.Sprintf("%.1f KB", float64(bytes)/float64(KB))
	default:
		return fmt.Sprintf("%d B", bytes)
	}
}

// storagePercent — процент использования хранилища.
func storagePercent(used, total int64) string {
	if total <= 0 {
		return "0"
	}
	pct := int(float64(used) / float64(total) * 100)
	if pct > 100 {
		pct = 100
	}
	return strconv.Itoa(pct)
}

// Dashboard — страница Dashboard с агрегированными метриками,
// статусами зависимостей, списком SE и графиками.
func Dashboard(data DashboardData) templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Var2 := templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
			templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
			templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
			if !templ_7745c5c3_IsBuffer {
				defer func() {
					templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
					if templ_7745c5c3_Err == nil {
						templ_7745c5c3_Err = templ_7745c5c3_BufErr
					}
				}()
			}
			ctx = templ.InitializeContext(ctx)
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<!-- Карточки метрик --> <div class=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4 mb-6\">")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = components.StatCard(components.StatCardParams{
				Label:       "Storage Elements",
				Value:       strconv.Itoa(data.SETotal),
				SubValue:    seSubValue(data),
				Icon:        "M21.75 17.25v-.228a4.5 4.5 0 00-.12-1.03l-2.268-9.64a3.375 3.375 0 00-3.285-2.602H7.923a3.375 3.375 0 00-3.285 2.602l-2.268 9.64a4.5 4.5 0 00-.12 1.03v.228m19.5 0a3 3 0 01-3 3H5.25a3 3 0 01-3-3m19.5 0a3 3 0 00-3-3H5.25a3 3 0 00-3 3m16.5 0h.008v.008h-.008v-.008zm-3 0h.008v.008h-.008v-.008z",
				BorderColor: "border-accent-primary",
			}).Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = components.StatCard(components.StatCardParams{
				Label:       "Файлы",
				Value:       strconv.Itoa(data.FilesTotal),
				SubValue:    filesSubValue(data),
				Icon:        "M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z",
				BorderColor: "border-status-info",
			}).Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = components.StatCard(components.StatCardParams{
				Label:       "Хранилище",
				Value:       storagePercent(data.StorageUsedBytes, data.StorageTotalBytes) + "%",
				SubValue:    storageSubValue(data),
				Icon:        "M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125v-3.75",
				BorderColor: "border-status-warning",
			}).Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = components.StatCard(components.StatCardParams{
				Label:       "Service Accounts",
				Value:       strconv.Itoa(data.SATotal),
				SubValue:    saSubValue(data),
				Icon:        "M15.75 5.25a3 3 0 013 3m3 0a6 6 0 01-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1121.75 8.25z",
				BorderColor: "border-accent-lime",
			}).Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 2, "</div><!-- Общий capacity bar хранилища --> ")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			if data.StorageTotalBytes > 0 {
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 3, "<div class=\"card mb-6\"><h2 class=\"text-lg font-semibold text-text-primary mb-3\">Общее хранилище</h2>")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
				templ_7745c5c3_Err = components.CapacityBar(components.CapacityBarParams{
					Used:  data.StorageUsedBytes,
					Total: data.StorageTotalBytes,
					Label: "Все Storage Elements",
				}).Render(ctx, templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 4, "</div>")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 5, " <!-- Статус зависимостей --> <div class=\"card mb-6\"><h2 class=\"text-lg font-semibold text-text-primary mb-4\">Зависимости</h2><div class=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			for _, dep := range data.Dependencies {
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 6, "<div class=\"flex items-center justify-between p-3 bg-bg-elevated rounded-lg\"><div class=\"flex items-center space-x-3\"><!-- Иконка зависимости -->")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
				if dep.Name == "PostgreSQL" {
					templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 7, "<div class=\"w-8 h-8 rounded-lg bg-bg-base flex items-center justify-center\"><svg class=\"w-4 h-4 text-text-secondary\" fill=\"none\" viewBox=\"0 0 24 24\" stroke-width=\"1.5\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125v-3.75\"></path></svg></div>")
					if templ_7745c5c3_Err != nil {
						return templ_7745c5c3_Err
					}
				} else {
					templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 8, "<div class=\"w-8 h-8 rounded-lg bg-bg-base flex items-center justify-center\"><svg class=\"w-4 h-4 text-text-secondary\" fill=\"none\" viewBox=\"0 0 24 24\" stroke-width=\"1.5\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z\"></path></svg></div>")
					if templ_7745c5c3_Err != nil {
						return templ_7745c5c3_Err
					}
				}
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 9, "<span class=\"text-sm font-medium text-text-primary\">")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
				var templ_7745c5c3_Var3 string
				templ_7745c5c3_Var3, templ_7745c5c3_Err = templ.JoinStringErrs(dep.Name)
				if templ_7745c5c3_Err != nil {
					return templ.Error{Err: templ_7745c5c3_Err, FileName: `internal/ui/pages/dashboard.templ`, Line: 285, Col: 69}
				}
				_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var3))
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 10, "</span></div><!-- Статус бейдж -->")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
				if dep.Status == "unavailable" {
					templ_7745c5c3_Err = components.Badge(components.BadgeNeutral, "N/A").Render(ctx, templ_7745c5c3_Buffer)
					if templ_7745c5c3_Err != nil {
						return templ_7745c5c3_Err
					}
				} else {
					templ_7745c5c3_Err = components.StatusBadge(dep.Status).Render(ctx, templ_7745c5c3_Buffer)
					if templ_7745c5c3_Err != nil {
						return templ_7745c5c3_Err
					}
				}
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 11, "</div>")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 12, "</div></div><!-- Таблица Storage Elements и графики (только если есть SE) --> ")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			if len(data.StorageElements) > 0 {
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 13, "<!-- Таблица SE --> <div class=\"card mb-6\"><div class=\"flex items-center justify-between mb-4\"><h2 class=\"text-lg font-semibold text-text-primary\">Storage Elements</h2><span class=\"text-sm text-text-muted\">")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
				var templ_7745c5c3_Var4 string
				templ_7745c5c3_Var4, templ_7745c5c3_Err = templ.JoinStringErrs(strconv.Itoa(len(data.StorageElements)))
				if templ_7745c5c3_Err != nil {
					return templ.Error{Err: templ_7745c5c3_Err, FileName: `internal/ui/pages/dashboard.templ`, Line: 304, Col: 84}
				}
				_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var4))
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 14, " зарегистрировано</span></div><div class=\"overflow-x-auto\"><table class=\"w-full text-sm\"><thead><tr class=\"border-b border-border-primary text-left\"><th class=\"pb-3 pr-4 text-text-muted font-medium\">Имя</th><th class=\"pb-3 pr-4 text-text-muted font-medium\">Режим</th><th class=\"pb-3 pr-4 text-text-muted font-medium\">Статус</th><th class=\"pb-3 pr-4 text-text-muted font-medium min-w-[160px]\">Ёмкость</th><th class=\"pb-3 pr-4 text-text-muted font-medium text-right\">Файлов</th><th class=\"pb-3 text-text-muted font-medium\"></th></tr></thead> <tbody class=\"divide-y divide-border-primary\">")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
				for _, se := range data.StorageElements {
					templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 15, "<tr class=\"hover:bg-bg-elevated/50 transition-colors\"><td class=\"py-3 pr-4\"><span class=\"text-text-primary font-medium\">")
					if templ_7745c5c3_Err != nil {
						return templ_7745c5c3_Err
					}
					var templ_7745c5c3_Var5 string
					templ_7745c5c3_Var5, templ_7745c5c3_Err = templ.JoinStringErrs(se.Name)
					if templ_7745c5c3_Err != nil {
						return templ.Error{Err: templ_7745c5c3_Err, FileName: `internal/ui/pages/dashboard.templ`, Line: 322, Col: 63}
					}
					_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var5))
					if templ_7745c5c3_Err != nil {
						return templ_7745c5c3_Err
					}
					templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 16, "</span></td><td class=\"py-3 pr-4\">")
					if templ_7745c5c3_Err != nil {
						return templ_7745c5c3_Err
					}
					templ_7745c5c3_Err = components.ModeBadge(se.Mode).Render(ctx, templ_7745c5c3_Buffer)
					if templ_7745c5c3_Err != nil {
						return templ_7745c5c3_Err
					}
					templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 17, "</td><td class=\"py-3 pr-4\">")
					if templ_7745c5c3_Err != nil {
						return templ_7745c5c3_Err
					}
					templ_7745c5c3_Err = components.StatusBadge(se.Status).Render(ctx, templ_7745c5c3_Buffer)
					if templ_7745c5c3_Err != nil {
						return templ_7745c5c3_Err
					}
					templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 18, "</td><td class=\"py-3 pr-4\">")
					if templ_7745c5c3_Err != nil {
						return templ_7745c5c3_Err
					}
					templ_7745c5c3_Err = components.CapacityBar(components.CapacityBarParams{
						Used:    se.UsedBytes,
						Total:   se.CapacityBytes,
						Compact: true,
					}).Render(ctx, templ_7745c5c3_Buffer)
					if templ_7745c5c3_Err != nil {
						return templ_7745c5c3_Err
					}
					templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 19, "</td><td class=\"py-3 pr-4 text-right\"><span class=\"text-text-secondary\">")
					if templ_7745c5c3_Err != nil {
						return templ_7745c5c3_Err
					}
					var templ_7745c5c3_Var6 string
					templ_7745c5c3_Var6, templ_7745c5c3_Err = templ.JoinStringErrs(strconv.Itoa(se.FileCount))
					if templ_7745c5c3_Err != nil {
						return templ.Error{Err: templ_7745c5c3_Err, FileName: `internal/ui/pages/dashboard.templ`, Line: 338, Col: 72}
					}
					_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var6))
					if templ_7745c5c3_Err != nil {
						return templ_7745c5c3_Err
					}
					templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 20, "</span></td><td class=\"py-3 text-right\"><a href=\"")
					if templ_7745c5c3_Err != nil {
						return templ_7745c5c3_Err
					}
					var templ_7745c5c3_Var7 templ.SafeURL
					templ_7745c5c3_Var7, templ_7745c5c3_Err = templ.JoinURLErrs(templ.SafeURL(fmt.Sprintf("/admin/storage-elements/%s", se.ID)))
					if templ_7745c5c3_Err != nil {
						return templ.Error{Err: templ_7745c5c3_Err, FileName: `internal/ui/pages/dashboard.templ`, Line: 342, Col: 81}
					}
					_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var7))
					if templ_7745c5c3_Err != nil {
						return templ_7745c5c3_Err
					}
					templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 21, "\" class=\"text-accent-primary hover:text-accent-hover text-xs\">Подробнее →</a></td></tr>")
					if templ_7745c5c3_Err != nil {
						return templ_7745c5c3_Err
					}
				}
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 22, "</tbody></table></div></div><!-- Графики --> <div class=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\"><!-- График: использование хранилища по SE (horizontal bar chart) --><div class=\"card\"><h2 class=\"text-lg font-semibold text-text-primary mb-4\">Использование хранилища</h2><div id=\"storage-chart\" x-data=\"")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
				var templ_7745c5c3_Var8 string
				templ_7745c5c3_Var8, templ_7745c5c3_Err = templ.JoinStringErrs(fmt.Sprintf("{ chartData: %s }", storageChartJSON(data.StorageElements)))
				if templ_7745c5c3_Err != nil {
					return templ.Error{Err: templ_7745c5c3_Err, FileName: `internal/ui/pages/dashboard.templ`, Line: 362, Col: 87}
				}
				_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var8))
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 23, "\" x-init=\"\n\t\t\t\t\t\t\tif (chartData.names.length > 0) {\n\t\t\t\t\t\t\t\tnew ApexCharts(document.querySelector('#storage-chart-container'), {\n\t\t\t\t\t\t\t\t\tchart: {\n\t\t\t\t\t\t\t\t\t\ttype: 'bar',\n\t\t\t\t\t\t\t\t\t\theight: Math.max(200, chartData.names.length * 50),\n\t\t\t\t\t\t\t\t\t\tbackground: 'transparent',\n\t\t\t\t\t\t\t\t\t\ttoolbar: { show: false },\n\t\t\t\t\t\t\t\t\t\tfontFamily: 'Inter, sans-serif',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tplotOptions: {\n\t\t\t\t\t\t\t\t\t\tbar: {\n\t\t\t\t\t\t\t\t\t\t\thorizontal: true,\n\t\t\t\t\t\t\t\t\t\t\tbarHeight: '60%',\n\t\t\t\t\t\t\t\t\t\t\tborderRadius: 4,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tseries: [\n\t\t\t\t\t\t\t\t\t\t{ name: 'Используется (GB)', data: chartData.used },\n\t\t\t\t\t\t\t\t\t\t{ name: 'Свободно (GB)', data: chartData.total.map((t, i) => Math.max(0, +(t - chartData.used[i]).toFixed(2))) },\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tcolors: ['#22c55e', '#374151'],\n\t\t\t\t\t\t\t\t\txaxis: {\n\t\t\t\t\t\t\t\t\t\tcategories: chartData.names,\n\t\t\t\t\t\t\t\t\t\tlabels: {\n\t\t\t\t\t\t\t\t\t\t\tstyle: { colors: '#9ca3af', fontSize: '12px' },\n\t\t\t\t\t\t\t\t\t\t\tformatter: (v) => v.toFixed(1) + ' GB',\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tyaxis: {\n\t\t\t\t\t\t\t\t\t\tlabels: {\n\t\t\t\t\t\t\t\t\t\t\tstyle: { colors: '#9ca3af', fontSize: '12px' },\n\t\t\t\t\t\t\t\t\t\t\tmaxWidth: 120,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tgrid: {\n\t\t\t\t\t\t\t\t\t\tborderColor: '#374151',\n\t\t\t\t\t\t\t\t\t\tstrokeDashArray: 4,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tlegend: {\n\t\t\t\t\t\t\t\t\t\tlabels: { colors: '#9ca3af' },\n\t\t\t\t\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\t\t\t\ttheme: 'dark',\n\t\t\t\t\t\t\t\t\t\ty: { formatter: (v) => v.toFixed(2) + ' GB' },\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tdataLabels: { enabled: false },\n\t\t\t\t\t\t\t\t\tstates: {\n\t\t\t\t\t\t\t\t\t\thover: { filter: { type: 'lighten', value: 0.1 } },\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t}).render();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\"><div id=\"storage-chart-container\"></div></div></div><!-- График: распределение файлов по SE (donut chart) --><div class=\"card\"><h2 class=\"text-lg font-semibold text-text-primary mb-4\">Распределение файлов</h2><div id=\"files-chart\" x-data=\"")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
				var templ_7745c5c3_Var9 string
				templ_7745c5c3_Var9, templ_7745c5c3_Err = templ.JoinStringErrs(fmt.Sprintf("{ chartData: %s }", filesChartJSON(data.StorageElements)))
				if templ_7745c5c3_Err != nil {
					return templ.Error{Err: templ_7745c5c3_Err, FileName: `internal/ui/pages/dashboard.templ`, Line: 427, Col: 85}
				}
				_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var9))
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 24, "\" x-init=\"\n\t\t\t\t\t\t\tif (chartData.names.length > 0) {\n\t\t\t\t\t\t\t\tnew ApexCharts(document.querySelector('#files-chart-container'), {\n\t\t\t\t\t\t\t\t\tchart: {\n\t\t\t\t\t\t\t\t\t\ttype: 'donut',\n\t\t\t\t\t\t\t\t\t\theight: 280,\n\t\t\t\t\t\t\t\t\t\tbackground: 'transparent',\n\t\t\t\t\t\t\t\t\t\tfontFamily: 'Inter, sans-serif',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tseries: chartData.counts,\n\t\t\t\t\t\t\t\t\tlabels: chartData.names,\n\t\t\t\t\t\t\t\t\tcolors: ['#22c55e', '#3b82f6', '#f59e0b', '#8b5cf6', '#ec4899', '#06b6d4'],\n\t\t\t\t\t\t\t\t\tlegend: {\n\t\t\t\t\t\t\t\t\t\tposition: 'bottom',\n\t\t\t\t\t\t\t\t\t\tlabels: { colors: '#9ca3af' },\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tplotOptions: {\n\t\t\t\t\t\t\t\t\t\tpie: {\n\t\t\t\t\t\t\t\t\t\t\tdonut: {\n\t\t\t\t\t\t\t\t\t\t\t\tsize: '65%',\n\t\t\t\t\t\t\t\t\t\t\t\tlabels: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tshow: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: { color: '#d1d5db' },\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcolor: '#f3f4f6',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformatter: (v) => v + ' файлов',\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\ttotal: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tshow: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcolor: '#9ca3af',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlabel: 'Всего',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformatter: (w) => w.globals.seriesTotals.reduce((a, b) => a + b, 0) + ' файлов',\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tdataLabels: { enabled: false },\n\t\t\t\t\t\t\t\t\tstroke: { width: 2, colors: ['#1a1a2e'] },\n\t\t\t\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\t\t\t\ttheme: 'dark',\n\t\t\t\t\t\t\t\t\t\ty: { formatter: (v) => v + ' файлов' },\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tstates: {\n\t\t\t\t\t\t\t\t\t\thover: { filter: { type: 'lighten', value: 0.1 } },\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t}).render();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$el.querySelector('#files-chart-container').innerHTML = '<p class=\\'text-sm text-text-muted text-center py-8\\'>Нет файлов для отображения</p>';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\"><div id=\"files-chart-container\"></div></div></div></div>")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
			} else {
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 25, "<!-- Пустое состояние: нет SE --> <div class=\"card mb-6 text-center py-8\"><svg class=\"w-12 h-12 text-text-muted mx-auto mb-3\" fill=\"none\" viewBox=\"0 0 24 24\" stroke-width=\"1.5\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M21.75 17.25v-.228a4.5 4.5 0 00-.12-1.03l-2.268-9.64a3.375 3.375 0 00-3.285-2.602H7.923a3.375 3.375 0 00-3.285 2.602l-2.268 9.64a4.5 4.5 0 00-.12 1.03v.228m19.5 0a3 3 0 01-3 3H5.25a3 3 0 01-3-3m19.5 0a3 3 0 00-3-3H5.25a3 3 0 00-3 3m16.5 0h.008v.008h-.008v-.008zm-3 0h.008v.008h-.008v-.008z\"></path></svg><p class=\"text-text-secondary font-medium mb-1\">Нет зарегистрированных Storage Elements</p><p class=\"text-sm text-text-muted\">Зарегистрируйте SE через раздел «Storage Elements» в меню навигации</p></div>")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
			}
			return nil
		})
		templ_7745c5c3_Err = layouts.Page(layouts.PageParams{
			Title:     "Dashboard",
			Username:  data.Username,
			Role:      data.Role,
			ActiveNav: "dashboard",
			Breadcrumbs: []layouts.BreadcrumbItem{
				{Label: "Dashboard"},
			},
		}).Render(templ.WithChildren(ctx, templ_7745c5c3_Var2), templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

var _ = templruntime.GeneratedTemplate
